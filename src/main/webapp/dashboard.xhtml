<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Dashboard - Gestión de Flotas</title>
        <style>
            body{ margin:0; height:100vh; font-family:Arial,sans-serif; color:#fff;
                  background:url("#{resource['images/login.png']}") no-repeat center/cover fixed; }
            .topbar{ display:flex; justify-content:flex-end; align-items:center; background:rgba(50,50,50,.9);
                     padding:.8rem 1.5rem; box-shadow:0 2px 10px rgba(0,0,0,.5); position:fixed; inset:0 0 auto 0; z-index:1000; }
            .topbar .ui-button{ background:#555!important; border:none!important; color:#fff!important; font-weight:bold;
                                border-radius:6px; padding:.5rem 1rem; margin-left:.8rem; }
            .topbar .ui-button:hover{ background:#777!important; }
            .content{ padding:6rem 2rem 2rem; display:flex; justify-content:center; align-items:center; }
            .card{ background:rgba(50,50,50,.6); border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,.4);
                   padding:2rem; width:90%; max-width:1100px; text-align:center; }
            .kpis{ display:flex; gap:1.2rem; justify-content:center; flex-wrap:wrap; margin-top:1rem; }
            .kpi{ flex:1 1 260px; min-width:260px; max-width:360px; background:rgba(0,0,0,.35);
                  border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:1.2rem 1.4rem; position:relative; overflow:hidden; }
            .kpi .kpi-icon{ position:absolute; right:1rem; top:1rem; font-size:2rem; opacity:.35; }
            .kpi .kpi-label{ letter-spacing:.5px; text-transform:uppercase; font-size:.9rem; opacity:.9; }
            .kpi .kpi-value{ font-size:3rem; line-height:1.1; font-weight:800; margin-top:.2rem; }
            .kpi .kpi-foot{ margin-top:.4rem; font-size:.85rem; opacity:.8; }
            /* Hacer la tarjeta clicable sin perder estilos */
            .kpi-link{ display:block; color:inherit; text-decoration:none; }
        </style>
    </h:head>

    <h:body>
        <!-- Topbar -->
        <h:form>
            <div class="topbar">
                <p:commandButton value="Registro Conductor" icon="pi pi-user-plus" action="registroConductor.xhtml?faces-redirect=true"/>
                <p:commandButton value="Asignación Conductor" icon="pi pi-id-card" action="asignacionConductor.xhtml?faces-redirect=true"/>
                <p:commandButton value="Ver Rutas" icon="pi pi-map" action="mapas.xhtml?faces-redirect=true"/>
                <p:commandButton value="Cerrar Sesión" icon="pi pi-sign-out" action="login.xhtml?faces-redirect=true"/>
            </div>
        </h:form>

        <!-- Contenido -->
        <div class="content">
            <div class="card">
                <h1>Bienvenido al Dashboard de Gestión de Flotas</h1>
                <p>Aquí podrás administrar conductores, asignaciones y rutas.</p>

                <h:form id="kpiForm">
                    <!-- Auto-refresh -->
                    <p:poll interval="15" listener="#{dashboardBean.cargarKPIs}" update="kpiBox" />

                    <h:panelGroup id="kpiBox">
                        <div class="kpis">

                            <!-- Conductores en ruta -->
                            <p:commandLink styleClass="kpi-link" action="#{dashboardBean.irConductoresEnRuta}">
                                <div class="kpi">
                                    <span class="pi pi-truck kpi-icon"></span>
                                    <div class="kpi-label">Conductores en ruta</div>
                                    <div class="kpi-value">#{dashboardBean.conductoresEnRuta}</div>
                                    <div class="kpi-foot">en tiempo real</div>
                                </div>
                            </p:commandLink>

                            <!-- Conductores activos -->
                            <p:commandLink styleClass="kpi-link" action="#{dashboardBean.irConductoresActivos}">
                                <div class="kpi">
                                    <span class="pi pi-user kpi-icon"></span>
                                    <div class="kpi-label">Conductores activos</div>
                                    <div class="kpi-value">#{dashboardBean.conductoresActivos}</div>
                                    <div class="kpi-foot">operativos hoy</div>
                                </div>
                            </p:commandLink>

                            <!-- Viajes finalizados -->
                            <p:commandLink styleClass="kpi-link" action="#{dashboardBean.irViajesFinalizados}">
                                <div class="kpi">
                                    <span class="pi pi-flag kpi-icon"></span>
                                    <div class="kpi-label">Viajes finalizados</div>
                                    <div class="kpi-value">#{dashboardBean.viajesFinalizados}</div>
                                    <div class="kpi-foot">últimas 24 horas</div>
                                </div>
                            </p:commandLink>

                        </div>
                    </h:panelGroup>
                    <h:panelGroup id="kpiBox1">
                        <div class="kpis">



                            <!-- Conductores activos -->
                            <p:commandLink styleClass="kpi-link" action="#{dashboardBean.irConductoresActivos}">
                                <div class="kpi">
                                    <span class="pi pi-user kpi-icon"></span>
                                    <div class="kpi-label">Disponibilidad de la Flota</div>
                                    <div class="kpi-value">#{dashboardBean.viajesPorConductor}</div>
                                    <div class="kpi-foot">operativos para hoy</div>
                                </div>
                            </p:commandLink>

                            <!-- Viajes finalizados -->
                            <p:commandLink styleClass="kpi-link" action="#{dashboardBean.irViajesFinalizados}">
                                <div class="kpi">
                                    <span class="pi pi-flag kpi-icon"></span>
                                    <div class="kpi-label">Tiempo promedio por viaje</div>
                                    <div class="kpi-value">#{dashboardBean.promedioViaje}</div>
                                    <div class="kpi-foot">horas</div>
                                </div>
                            </p:commandLink>

                        </div>
                    </h:panelGroup>

                </h:form>
            </div>
        </div>
    </h:body>
</html>
